var style_cookie,style_cookie_txt,style_cookie_site,kumod_set=!1,quick_reply=!1,ispage;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for((n=n<0?Math.ceil(n):Math.floor(n))<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1});var Utf8={encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var a=e.charCodeAt(n);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t},decode:function(e){for(var t="",n=0,a=c1=c2=0;n<e.length;)(a=e.charCodeAt(n))<128?(t+=String.fromCharCode(a),n++):a>191&&a<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&a)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&a)<<12|(63&c2)<<6|63&c3),n+=3);return t}},gt=new Gettext({domain:"kusaba"});function _(e){return gt.gettext(e)}function toggle(e,t){var n=document.getElementById(t);n.style.display?n.style.display="":n.style.display="none",e.innerHTML=n.style.display?"+":"&minus;",set_cookie("nav_show_"+t,n.style.display?"0":"1",30)}function removeframes(){for(var e=document.getElementsByTagName("a"),t=0;t<e.length;t++)"boardlink"==e[t].className&&(e[t].target="_top");return document.getElementById("removeframes").innerHTML="Frames removed.",!1}function reloadmain(){parent.main&&parent.main.location.reload()}function replaceAll(e,t,n){for(var a=e.indexOf(t);a>-1;)a=(e=e.replace(t,n)).indexOf(t);return e}function insert(e){if(!ispage||quick_reply){var t=document.forms.postform.message;if(t){if(t.createTextRange&&t.caretPos){var n=t.caretPos;n.text=" "==n.text.charAt(n.text.length-1)?e+" ":e}else if(t.setSelectionRange){var a=t.selectionStart,o=t.selectionEnd;t.value=t.value.substr(0,a)+e+t.value.substr(o),t.setSelectionRange(a+e.length,a+e.length)}else t.value+=e+" ";return t.focus(),!1}}return!0}function quote(b,a){var v=eval("document."+a+".message");v.value+=">>"+b+"\r",v.focus()}function checkhighlight(){var e;(e=/#i([0-9]+)/.exec(document.location.toString()))&&(document.forms.postform.message.value||insert(">>"+e[1]+"\n")),(e=/#([0-9]+)/.exec(document.location.toString()))&&highlight(e[1])}function highlight(e,t){for(var n=document.getElementsByTagName("td"),a=0;a<n.length;a++)"highlight"==n[a].className&&(n[a].className="reply");for(var o=document.getElementById("reply"+e),r=o.parentNode;"TABLE"!=r.nodeName;)r=r.parentNode;if((o||document.postform.replythread.value==e)&&"reflinkpreview"!=r.parentNode.className){o&&(o.className="highlight");var i=/^([^#]*)/.exec(document.location.toString());return document.location=i[1]+"#"+e,!1}return!0}function get_password(e){if(n=getCookie(e))return n;for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n="",a=0;a<8;a++){var o=Math.floor(Math.random()*t.length);n+=t.substring(o,o+1)}return set_cookie(e,n,365),n}function togglePassword(){var e=-1!=navigator.userAgent.indexOf("Safari"),t=-1!=navigator.userAgent.indexOf("Opera"),n="Netscape"==navigator.appName,a=document.getElementById("passwordbox");if(a){if((e||t||n?a.innerHTML:a.text).toLowerCase()==(o="<td></td><td></td>"))var o='<td class="postblock">Mod</td><td><input type="text" name="modpassword" size="28" maxlength="75">&nbsp;<acronym title="Display staff status (Mod/Admin)">D</acronym>:&nbsp;<input type="checkbox" name="displaystaffstatus" checked>&nbsp;<acronym title="Lock">L</acronym>:&nbsp;<input type="checkbox" name="lockonpost">&nbsp;&nbsp;<acronym title="Sticky">S</acronym>:&nbsp;<input type="checkbox" name="stickyonpost">&nbsp;&nbsp;<acronym title="Raw HTML">RH</acronym>:&nbsp;<input type="checkbox" name="rawhtml">&nbsp;&nbsp;<acronym title="Name">N</acronym>:&nbsp;<input type="checkbox" name="usestaffname"></td>';e||t||n?a.innerHTML=o:a.text=o}return!1}function toggleOptions(e,t,n){if(document.getElementById("opt"+e))if(""==document.getElementById("opt"+e).style.display)document.getElementById("opt"+e).style.display="none",document.getElementById("opt"+e).innerHTML="";else{var a='<td class="label"><label for="formatting">Formatting:</label></td><td colspan="3"><select name="formatting"><option value="" onclick="javascript:document.getElementById(\'formattinginfo'+e+"').innerHTML = 'All formatting is performed by the user.';\">Normal</option><option value=\"aa\" onclick=\"javascript:document.getElementById('formattinginfo"+e+"').innerHTML = '[aa] and [/aa] will surround your message.';\"";"aa"==getCookie("kuformatting")&&(a+=" selected"),a+='>Text Art</option></select> <input type="checkbox" name="rememberformatting"><label for="rememberformatting">Remember</label> <span id="formattinginfo'+e+'">',"aa"==getCookie("kuformatting")?a+="[aa] and [/aa] will surround your message.":a+="All formatting is performed by the user.",a+='</span></td><td><input type="button" value="Preview" class="submit" onclick="javascript:postpreview(\'preview'+e+"', '"+n+"', '"+e+"', document."+t+'.message.value);"></td>',document.getElementById("opt"+e).innerHTML=a,document.getElementById("opt"+e).style.display=""}}function getCookie(e){return b=Cookies.get(e),b||""}function set_cookie(e,t,n){if(n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var o="; expires="+a.toGMTString()}else o="";document.cookie=e+"="+t+o+"; path=/"}function del_cookie(e){document.cookie=e+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/"}function set_stylesheet(e,t,n){t?e==get_default_stylesheet()?del_cookie("kustyle_txt"):set_cookie("kustyle_txt",e,365):n?e==get_default_stylesheet()?del_cookie("kustyle_site"):set_cookie("kustyle_site",e,365):e==get_default_stylesheet()?del_cookie("kustyle"):set_cookie("kustyle",e,365);for(var a=document.getElementsByTagName("link"),o=!1,r=0;r<a.length;r++){var i=a[r].getAttribute("rel"),s=a[r].getAttribute("title");-1!=i.indexOf("style")&&s&&(a[r].disabled=!0,e==s&&(a[r].disabled=!1,o=!0))}o||set_preferred_stylesheet()}function set_preferred_stylesheet(){for(var e=document.getElementsByTagName("link"),t=0;t<e.length;t++){var n=e[t].getAttribute("rel"),a=e[t].getAttribute("title");-1!=n.indexOf("style")&&a&&(e[t].disabled=-1!=n.indexOf("alt"))}}function get_active_stylesheet(){for(var e=document.getElementsByTagName("link"),t=0;t<e.length;t++){var n=e[t].getAttribute("rel"),a=e[t].getAttribute("title");if(-1!=n.indexOf("style")&&a&&!e[t].disabled)return a}return null}function get_preferred_stylesheet(){for(var e=document.getElementsByTagName("link"),t=0;t<e.length;t++){var n=e[t].getAttribute("rel"),a=e[t].getAttribute("title");if(-1!=n.indexOf("style")&&-1==n.indexOf("alt")&&a)return a}return null}function get_default_stylesheet(){for(var e=document.getElementsByTagName("link"),t=0;t<e.length;t++){var n=e[t].getAttribute("rel"),a=e[t].getAttribute("title");if(-1!=n.indexOf("style")&&a&&"alternate stylesheet"!=n)return a}return null}function delandbanlinks(){if(kumod_set){togglePassword();var e=document.getElementById("fileonly");e&&((e=e.parentNode).innerHTML='[<input type="checkbox" name="fileonly" id="fileonly" value="on" /><label for="fileonly">File Only</label>] <input name="moddelete" onclick="return confirm(_(\'Are you sure you want to delete these posts?\'))" value="'+_("Delete")+'" type="submit" /> <input name="modban" value="'+_("Ban")+'" onclick="this.form.action=\''+ku_cgipath+'/manage_page.php?action=bans\';" type="submit" />');for(var t,n,a=document.getElementsByTagName("span"),o=0;o<a.length;o++)if((t=a[o]).getAttribute("id")&&"dnb"==t.getAttribute("id").substr(0,3)){n=t.getAttribute("id").split("-"),t.innerHTML="";var r="";new Ajax.Request(ku_boardspath+"/manage_page.php?action=getip&boarddir="+n[1]+"&id="+n[2],{method:"get",onSuccess:function(e){ipaddr=e.responseText.split("=")||"what are you doing get out you don't even fit",span=document.getElementById(ipaddr[0]),span.innerHTML="[IP: "+ipaddr[1]+' <a href="'+ku_boardspath+"/manage_page.php?action=deletepostsbyip&ip="+ipaddr[1]+'" title="'+_("Delete all posts by this IP")+'">D</a> / <a href="'+ku_boardspath+"/manage_page.php?action=ipsearch&ip="+ipaddr[1]+'" title="'+_("Search for posts with this IP")+'">S</a>] '+span.innerHTML},onFailure:function(){r="[what are you doing get out you don't even fit]",t.innerHTML=r}}),r+='&#91;<a href="'+ku_cgipath+"/manage_page.php?action=delposts&boarddir="+n[1]+"&del","y"==n[3]?r+="thread":r+="post",r+="id="+n[2]+'" title="'+_("Delete")+'" onclick="return confirm(_(\'Are you sure you want to delete this post/thread?\'));">D</a>&nbsp;<a href="'+ku_cgipath+"/manage_page.php?action=delposts&boarddir="+n[1]+"&del","y"==n[3]?r+="thread":r+="post",r+="id="+n[2]+"&postid="+n[2]+'" title="'+_("Delete &amp; Ban")+'" onclick="return confirm(_(\'Are you sure you want to delete and ban the poster of this post/thread?\'));">&amp;</a>&nbsp;<a href="'+ku_cgipath+"/manage_page.php?action=bans&banboard="+n[1]+"&banpost="+n[2]+'" title="'+_("Ban")+'">B</a>&#93;&nbsp;&#91;<a href="'+ku_cgipath+"/manage_page.php?action=bans&banboard="+n[1]+"&banpost="+n[2]+'&instant=y" title="'+_("Instant Permanent Ban")+'" onclick="instantban(\''+n[1]+"',"+n[2]+'); return false;">P</a>&#93;&nbsp;&#91;<a href="'+ku_cgipath+"/manage_page.php?action=delposts&boarddir="+n[1]+"&del","y"==n[3]?r+="thread":r+="post",r+="id="+n[2]+"&postid="+n[2]+'&cp=y" title="'+_("Child Pornography")+'" onclick="return confirm(_(\'Are you sure that this is child pornography?\'));">CP</a>&#93;',a[o].innerHTML=r}}}function instantban(e,t){var n=prompt(_('Are you sure you want to permenently ban the poster of this post/thread?\nIf so enter a ban message or click OK to use the default ban reason. To cancel this operation, click "Cancel".'));if(null!==n){var a=ku_cgipath+"/manage_page.php?action=bans&banboard="+e+"&banpost="+t+"&instant=y";""!=n&&(a+="&reason="+n),new Ajax.Request(a,{method:"get",onSuccess:function(e){"success"==(e.responseText||"Ban failed!")?alert(_("Ban was sucessful.")):alert(_("Ban failed!"))},onFailure:function(){alert(_("Ban failed!"))}})}else alert(_("OK, no action taken."))}function togglethread(e){return-1!==hiddenthreads.toString().indexOf(e)?(document.getElementById("unhidethread"+e).style.display="none",document.getElementById("thread"+e).style.display="block",hiddenthreads.splice(hiddenthreads.indexOf(e),1),set_cookie("hiddenthreads",hiddenthreads.join("!"),30)):(document.getElementById("unhidethread"+e).style.display="block",document.getElementById("thread"+e).style.display="none",hiddenthreads.push(e),set_cookie("hiddenthreads",hiddenthreads.join("!"),30)),!1}function toggleblotter(e){var t,n=document.getElementsByTagName("li");new Array;for(i=0,iarr=0;i<n.length;i++)att=n[i].getAttribute("class"),"blotterentry"==att&&("none"==(t=n[i]).style.display?(t.style.display="",e&&set_cookie("ku_showblotter","1",365)):(t.style.display="none",e&&set_cookie("ku_showblotter","0",365)))}function expandthread(e,t){if(document.getElementById("replies"+e+t)){var n=document.getElementById("replies"+e+t);n.innerHTML=_("Expanding thread")+"...<br><br>"+n.innerHTML,new Ajax.Request(ku_boardspath+"/expand.php?board="+t+"&threadid="+e,{method:"get",onSuccess:function(e){var t=e.responseText||_("something went wrong (blank response)");n.innerHTML=t,delandbanlinks(),addpreviewevents()},onFailure:function(){alert(_("Something went wrong..."))}})}return!1}function quickreply(e){0==e?(quick_reply=!1,document.getElementById("posttypeindicator").innerHTML="new thread"):(quick_reply=!0,document.getElementById("posttypeindicator").innerHTML="reply to "+e+' [<a href="#postbox" onclick="javascript:quickreply(\'0\');" title="Cancel">x</a>]'),document.postform.replythread.value=e}function getwatchedthreads(e,t){if(document.getElementById("watchedthreadlist")){var n=document.getElementById("watchedthreadlist");n.innerHTML=_("Loading watched threads..."),new Ajax.Request(ku_boardspath+"/threadwatch.php?board="+t+"&threadid="+e,{method:"get",onSuccess:function(e){var t=e.responseText||_("something went wrong (blank response)");n.innerHTML=t},onFailure:function(){alert(_("Something went wrong..."))}})}}function addtowatchedthreads(e,t){document.getElementById("watchedthreadlist")&&new Ajax.Request(ku_boardspath+"/threadwatch.php?do=addthread&board="+t+"&threadid="+e,{method:"get",onSuccess:function(e){e.responseText||_("something went wrong (blank response)");alert("Thread successfully added to your watch list."),getwatchedthreads("0",t)},onFailure:function(){alert(_("Something went wrong..."))}})}function removefromwatchedthreads(e,t){document.getElementById("watchedthreadlist")&&new Ajax.Request(ku_boardspath+"/threadwatch.php?do=removethread&board="+t+"&threadid="+e,{method:"get",onSuccess:function(e){e.responseText||_("something went wrong (blank response)");getwatchedthreads("0",t)},onFailure:function(){alert(_("Something went wrong..."))}})}function hidewatchedthreads(){set_cookie("showwatchedthreads","0",30),document.getElementById("watchedthreads")&&(document.getElementById("watchedthreads").innerHTML=_("The Watched Threads box will be hidden the next time a page is loaded.")+' [<a href="#" onclick="javascript:showwatchedthreads();return false">'+_("undo")+"</a>]")}function showwatchedthreads(){set_cookie("showwatchedthreads","1",30),window.location.reload(!0)}function checkcaptcha(e){return!document.getElementById(e)||!document.getElementById(e).captcha||""!=document.getElementById(e).captcha.value||(alert("Please enter the captcha image text."),document.getElementById(e).captcha.focus(),!1)}function expandimg(e,t,n,a,o,r,i){element=document.getElementById("thumb"+e);var s='<img src="'+n+'" alt="'+e+'" class="thumb" width="'+r+'" height="'+i+'">',d='<img src="'+n+'" alt="'+e+'" class="thumb" height="'+i+'" width="'+r+'">',l='<img src="'+n+'" alt="'+e+'" class="thumb" height="'+i+'" width="'+r+'"/>',c="<img class=thumb height="+i+" alt="+e+' src="'+n+'" width='+r+">";element.innerHTML.toLowerCase()!=s&&element.innerHTML.toLowerCase()!=c&&element.innerHTML.toLowerCase()!=d&&element.innerHTML.toLowerCase()!=l?element.innerHTML=s:element.innerHTML='<img src="'+t+'" alt="'+e+'" class="thumb" height="'+o+'" width="'+a+'">'}function postpreview(e,t,n,a){document.getElementById(e)&&new Ajax.Request(ku_boardspath+"/expand.php?preview&board="+t+"&parentid="+n+"&message="+escape(a),{method:"get",onSuccess:function(t){var n=t.responseText||_("something went wrong (blank response)");document.getElementById(e).innerHTML=n},onFailure:function(){alert(_("Something went wrong..."))}})}function set_inputs(a){if(document.getElementById(a))with(document.getElementById(a))name.value||(name.value=getCookie("name")),em.value||(em.value=getCookie("email")),postpassword.value||(postpassword.value=get_password("postpassword"))}function set_delpass(a){if(document.getElementById(a).postpassword)with(document.getElementById(a))postpassword.value||(postpassword.value=get_password("postpassword"))}function addreflinkpreview(e){var t;t=this.href?this:e.srcElement,ainfo=t.className.split("|");var n=document.createElement("div");n.setAttribute("id","preview"+t.className),n.setAttribute("class","reflinkpreview"),n.setAttribute("className","reflinkpreview"),e.pageX?n.style.left=e.pageX+50+"px":n.style.left=e.clientX+50;var a=document.createTextNode("");n.appendChild(a);var o=t.parentNode.insertBefore(n,t);new Ajax.Request(ku_boardspath+"/read.php?b="+ainfo[1]+"&t="+ainfo[2]+"&p="+ainfo[3]+"&single",{method:"get",onSuccess:function(e){var t=e.responseText||_("something went wrong (blank response)");o.innerHTML=t},onFailure:function(){alert("wut")}})}function delreflinkpreview(e){var t;t=this.href?this:e.srcElement;var n=document.getElementById("preview"+t.className);n&&n.parentNode.removeChild(n)}function addpreviewevents(){for(var e,t=document.getElementsByTagName("a"),n=0;n<t.length;n++)(e=t[n]).className&&"ref|"==e.className.substr(0,4)&&(e.addEventListener?(e.addEventListener("mouseover",addreflinkpreview,!1),e.addEventListener("mouseout",delreflinkpreview,!1)):e.attachEvent&&(e.attachEvent("onmouseover",addreflinkpreview),e.attachEvent("onmouseout",delreflinkpreview)))}function keypress(e){if(e||(e=window.event),e.altKey){var t=document.location.toString();if((-1==t.indexOf("catalog.html")&&-1==t.indexOf("/res/")||-1==t.indexOf("catalog.html")&&80==e.keyCode)&&18!=e.keyCode&&16!=e.keyCode){if(-1==t.indexOf(".html")||-1!=t.indexOf("board.html"))var n=0,a=t.substr(0,t.lastIndexOf("/")+1);else{n=+(n=t.substr(t.lastIndexOf("/")+1)).substr(0,n.indexOf(".html"));a=t.substr(0,t.lastIndexOf("/")+1)}if(0==n)var o=a;else o=a+n+".html";if(222==e.keyCode||221==e.keyCode){if(match=/#s([0-9])/.exec(t))var r=+match[1];else r=-1;if(222==e.keyCode)if(-1==r||9==r)var i=0;else i=r+1;else if(221==e.keyCode)if(-1==r||0==r)i=9;else i=r-1;document.location.href=o+"#s"+i}else 59==e.keyCode||219==e.keyCode?(59==e.keyCode?n+=1:219==e.keyCode&&n>=1&&(n-=1),document.location.href=0==n?a:a+n+".html"):80==e.keyCode&&(document.location.href=o+"#postbox")}}}if(window.onload=function(e){if("allboards"==getCookie("kumod"))kumod_set=!0;else if(""!=getCookie("kumod")){var t=getCookie("kumod").split("|"),n=document.getElementById("postform").board.value;for(var a in t)if(t[a]==n){kumod_set=!0;break}}if(delandbanlinks(),addpreviewevents(),checkhighlight(),document.getElementById("watchedthreads")){new Draggable("watchedthreads",{handle:"watchedthreadsdraghandle",onEnd:function(){set_cookie("watchedthreadstop",document.getElementById("watchedthreads").style.top,30),set_cookie("watchedthreadsleft",document.getElementById("watchedthreads").style.left,30)}}),new Resizeable("watchedthreads",{resize:function(){var e,t;e=document.getElementById("watchedthreads").offsetWidth,t=document.getElementById("watchedthreads").offsetHeight,set_cookie("watchedthreadswidth",e,30),set_cookie("watchedthreadsheight",t,30)}})}document.onkeydown=keypress},style_cookie){var cookie=getCookie(style_cookie),title=cookie||get_preferred_stylesheet();title!=get_active_stylesheet()&&set_stylesheet(title)}if(style_cookie_txt){var cookie=getCookie(style_cookie_txt),title=cookie||get_preferred_stylesheet();set_stylesheet(title,!0)}if(style_cookie_site){var cookie=getCookie(style_cookie_site),title=cookie||get_preferred_stylesheet();set_stylesheet(title,!1,!0)}